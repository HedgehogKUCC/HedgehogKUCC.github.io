---
title: Gulp 進階
date: 2019-11-17
tags: gulp
---

# Gulp 進階

## 依據開發環境調整輸出內容

[minimist](https://www.npmjs.com/package/minimist)、[gulp-if](https://www.npmjs.com/package/gulp-if)

### 安裝

```bash
$ npm install --save minimist gulp-if
```

<br>

### 配置 gulpfile.js

```js
var minimist = require('minimist');

var envOptions = {
  string: 'env',
  default: { env: 'develop' }
}

var options = minimist(process.argv.slice(2), envOptions);
console.log(options);

// sass
.pipe($.if(options.env === 'production', $.cleanCss()))

// babel
.pipe($.if(options.env === 'production', $.uglify({
      compress: {
        drop_console: true
      }
    })))
```

<br>

### 輸出判斷

`develop`

```bash
$ gulp
```

<br>

`production`

```bash
$ gulp --env production
```

<br>

# 釋出開發成品

[gulp-clean](https://www.npmjs.com/package/gulp-clean)

## 安裝

```bash
$ npm install --save gulp-clean
```

### 配置 gulpfile.js

```js
gulp.task('clean', function () {
  return gulp.src(['./.tmp', './public'], {read: false, allowEmpty: true})
      .pipe($.clean());
});

gulp.task('build',
  gulp.series(
    'clean',
    gulp.parallel('jade', 'sass', 'babel', 'bower'),
    'vendorJs'
  )
);
```

<br>

如果沒加上 `allowEmpty: true`

    會發生 clean ERROR 如下:

    Error: File not found with singular glob: /Users/kucc/Desktop/DemoGulp/.tmp (if this was purposeful, use `allowEmpty` option)

